<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>

  <body>
    <p>test</p>

    <script type="text/javascript">

    let w = 700;
    let h = 500;

    let dataset;
    let margin = ({top: 20, right: 30, bottom: 30, left: 40})
    let padding = 50;

// CHAPTER 12 SELECTIONS ==========================================================
    d3.csv("fix_co2_mm_mlo.csv").then(function(data){

      data.forEach(function(d){
        d.date = new Date(+d.year, (+d.month - 1));
        d.average = parseFloat(d.average)
      });

      console.log(data[0]);
      // console.table(data, ["date", "average"]); // Ok
      dataset = data
      return dataset
    })

    .then(function(){
      let xScale = d3.scaleTime()
                     .domain([
                        d3.min(dataset,d=>d.date),
                        d3.max(dataset,d=>d.date)
                     ])
                     // .range([0,w]);
                     .range([margin.left, w - margin.right])

      let yScale = d3.scaleLinear()
                     .domain([300,d3.max(dataset,d=>d.average)])
                     // .range([h,0]);
                     .range([h - margin.bottom, margin.top])

       let line = d3.line()
                    .defined(d=> d.average >= 0 && d.average <= 350)
                    .x(d=>xScale(d.date))
                    .y(d=>yScale(d.average));

      let dangerline = d3.line()
                   .defined(d=> d.average >= 350)
                   .x(d=>xScale(d.date))
                   .y(d=>yScale(d.average));

       let HORIZdangerline = d3.line()
                    // .defined(d=> d.average >= 350)
                    .x(d=>xScale(d.date))
                    .y(d=>yScale(350));



  // CREATE SVG
        let svg = d3.select("body")
                    .append("svg")
                    .attr("viewBox", [0, 0, w, h])
                    .attr("width",w)
                    .attr("height",h)
                    .style('background-color', '#e9fffc')
  // CREATE line
        svg.append("path")
           .datum(dataset)
           .attr("class","line")
           .attr("stroke","green")
           .attr("d",line);
// CREATE red line
      svg.append("path")
              .datum(dataset)
              .attr("class","line")
              .attr("stroke","red")
              .attr("d",dangerline);

      svg.append("path")
              .datum(dataset)
              .attr("class","line")
              .attr("stroke","red")
              .attr("d",HORIZdangerline);
    // text
    svg.append("text")
            .attr("x", (100))
            .attr("y", (d => yScale(355)))
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("CO2 normal");


  // AXIS Y
      svg.append("g")
         // .attr("transform", "translate(50,0)")
         .attr("transform", `translate(${margin.left},0)`)
         .call(d3.axisLeft(yScale));
  // AXIS B
      svg.append("g")
         // .attr("transform", "translate(0,50)")
         .attr("transform", `translate(0,${h - margin.bottom})`)
         .call(d3.axisBottom(xScale));

    })



      // let barPadding = 1;
      //
      // // let dataset = [ 100, 200, 300, 400, 500 ];
      //
      // let dataset = [
      //               [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
      //               [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
      //               ];
      //
      // let xScale = d3.scaleLinear()
      //               .domain([0,d3.max(dataset,d=>d[0])])
      //               .range([0,w])
      //
      // let yScale = d3.scaleLinear()
      //               .domain([0,d3.max(dataset,d=>d[1])])
      //               .range([0,h])


//       // let dataset = [ 5, 10, 13, 19, 21, 13,
//       //                 11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
//
// // SCATERPLOT
//         let dataset = [
//                       [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
//                       [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
//                       ];
//
// // SVG SCATERPLOT
//         let svg = d3.select("body")
//                     .append("svg")
//                     .attr("width",w)
//                     .attr("height",h)
//                     .style("background-color","lightgreen");
//
//             svg.selectAll("circle")
//                .data(dataset)
//                .enter()
//                .append("circle")
// //              xy
//                .attr("cx",function(d){
//                  return d[0]; // [n0,n1]
//                })
//                .attr("cy",d=>d[1])
//                .attr("r",d=>Math.sqrt(h-d[1])/Math.PI)
// // labelas
//             svg.selectAll("text")
//                .data(dataset)
//                .enter()
//                .append("text")
//                .text(d=>d[0]+","+d[1])
//                .attr("x",d=>d[0])
//                .attr("y",d=>d[1])
//                .attr("font-family", "sans-serif")
//                .attr("font-size", "11px")
//                .attr("fill", "red");

// SVG
//       let svg = d3.select("body")
//          .append("svg")
//          .attr("width",w)
//          .attr("height",h)
//          .style("background-color","lightgreen");
// // =============================
// // RECT
//       svg.selectAll("rect")
//          .data(dataset)
//          .enter()
//          .append("rect")
//          .attr("x",(d,i)=>i*(w/dataset.length-barPadding))
//          // .attr("y",0)
//          .attr("y",d=>(h-d*4))
//          .attr("width",20)
//          .attr("height",d=>d*4)
//          .attr("fill",d=>"rgb(0, 0, " + Math.round(d * 10) + ")");
// // LABELS
//       svg.selectAll("tetx")
//          .data(dataset)
//          .enter()
//          .append("text")
//          .text(d=>d)
//          .attr("text-anchor", "middle")
// // LABELS xy
//          .attr("x",(d,i)=>i*(w/dataset.length-barPadding)+10)
//          .attr("y",d=>h-(d*4)+14)
//
//          .attr("font-family", "sans-serif")
//          .attr("font-size", "11px")
//          .attr("fill", "white");
// // CIRCLE FIGURE
//       let circles = svg.selectAll("circle")
//          .data(dataset)
//          .enter()
//          .append("circle");
//
// // + attr xyr
//       circles.attr("cx",(d,i)=>(i*50)+25)
//              .attr("cy",h/2)
//              .attr("r",d=>d);
// // + color
//       circles.attr("fill","yellow")
//              .attr("stroke","orange")
//              .attr("stroke-width", d=>d/2);
    </script>
  </body>
</html>
